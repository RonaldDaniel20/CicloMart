// Usa lenguaje dbml para definir la base de datos
// Documentación: https://dbml.dbdiagram.io/docs

// Posibles enums
Enum "usuario_rol_enum" {
  "comprador"
  "cliente"
  "administrador"
}

Enum "transaccion_estado_enum" {
  "pendiente"
  "exitosa"
  "fallida"
}

Enum "producto_disponibilidad_enum" {
  "disponible"
  "vendido"
  "reservado"
}

Enum "producto_estado_enum" {
  "nuevo"
  "usado"
}

Table "usuario" {
  "idUsuario" INT [pk, not null, increment]
  "nombre" VARCHAR(45) [not null]
  "apellido" VARCHAR(45) [not null]
  "fechaNacimiento" DATE 
  "rol" usuario_rol_enum [default:"comprador"]
  "foto" VARCHAR(255)
  "correo" VARCHAR [not null]
  "direccion" VARCHAR 
  "telefono" VARCHAR(60) 
  "username" VARCHAR(45) 
  "password" VARCHAR(64) [not null]
  "fechaRegistro" DATETIME [default: `now()`]
}

// Representa 
Table "modelo" {
  "idModelo" INT [pk, not null]
  "nombre" VARCHAR [not null]
  "tipo" VARCHAR(45) [not null]
  "descripcion" VARCHAR [not null]
  "idMarca" INT [not null]
  Indexes {
    idMarca [name: "idMarca"]
    nombre [name:"nombre"]
  }
}

Table "imagen" {
  "idImagen" INT [pk, not null, increment]
  "url" VARCHAR
  "idModelo" INT
  "idDocumento" INT
  "idUsuario" INT

  Indexes {
    idModelo [name: "imagen_modelo"]
    idDocumento [name: "imagen_documento"]
    idUsuario [name: "imagen_usuario"]
  }
}

Table "bicicleta" {
  "idBicicleta" INT [pk, not null]
  "tipoBicicleta" VARCHAR(45)
  "color" VARCHAR(45)
  "genero" VARCHAR(45)
  "edad" VARCHAR(45)
  "tamañoMarco" VARCHAR(45)
  "materialMarco" VARCHAR(45)
  "tamañoRueda" VARCHAR(45)
  "tipoFrenos" VARCHAR(45)
  "velocidades" VARCHAR(45)
  "suspension" VARCHAR(45)
  "transmision" VARCHAR(45)
  "tipoPedales" VARCHAR(45)
  "manubrio" VARCHAR(45)
  "pesoBicicleta" FLOAT
  "pesoMaximo" FLOAT
  "extras" VARCHAR(100)
  //Componentes especificos
  "idCadena" INT
  "idRueda" INT
  "idPedalier" INT
  "idSillin" INT
  "idFreno" INT
  "idManubrio" INT
  "idCassette" INT
  Indexes {
    idCadena [name: "modelo_ibfk_1"]
    idRueda [name: "modelo_ibfk_2"]
    idPedalier [name: "modelo_ibfk_3"]
    idSillin [name: "modelo_ibfk_4"]
    idFreno [name: "modelo_ibfk_5"]
    idManubrio [name: "modelo_ibfk_6"]
    idCassette [name: "modelo_ibfk_7"]
  }
}

Table "componente" {
  "idComponente" INT [pk, not null]
  "idMarca" INT
  "nombre" VARCHAR [not null]
  "categoria" VARCHAR
  "compatibilidad" VARCHAR
  Indexes {
    nombre [name:"nombre"]
    idMarca [name:"marca_ibfk_1"]
  }
}

Table "marca" {
  "idMarca" INT [pk, not null]
  "nombre" VARCHAR(45) [not null]
  Indexes {
    nombre [name:"nombre"]
  }
}

Table "tienda" {
  "idTienda" INT [pk, not null]
  "idUsuarioAdministrador" INT [not null]
  "nombre" varchar
  "descripcion" text
  "telefono" VARCHAR(60) 
  Indexes {
    nombre [name:"nombre"]
  }
}

Table "carrito" {
  "idCarrito" INT [pk, not null, increment]
  "idUsuario" INT [not null]
  "cantidadProductos" INT [default: '0']
  "precioTotal" FLOAT 
  "fecha" DATETIME 
  "estado" VARCHAR(45) 
  "metodoPago" VARCHAR(45) 
  "direccionEnvio" VARCHAR(45) 
  "descuento" FLOAT 
  Indexes {
    idUsuario [name: "idUsuario"]
  }
}

Table "carritoProducto" {
  "idCarritoProducto" INT [pk, not null, increment]
  "idCarrito" INT [not null]
  "idProducto" INT [not null]
  "cantidad" INT 
  "precio_unitario" FLOAT 

  Indexes {
    idCarrito [name: "idCarrito"]
  }
}

// Representa un documento oficial de propiedad
// sobre un producto
Table "documento" {
  "idDocumento" INT [pk, not null, increment]
  "idModelo" INT [not null]
  "idUsuario" INT
  "tipo" VARCHAR(60) 
  "descripcion" TEXT
  "estado" VARCHAR(60) 
  "fechaCompra" DATE

  Indexes {
    idUsuario [name: "idUsuario"]
  }
}

Table "producto" {
  "idProducto" INT [pk, not null, increment]
  "idModelo" INT [not null]
  "idTienda" INT
  "idVendedor" INT
  "precio" FLOAT
  "precioCompleto" FLOAT
  "cantidad" INT [default: 0]
  "estado" producto_estado_enum [default: "nuevo"]
  "disponibilidad" producto_disponibilidad_enum [default: "disponible"]
  "costoEnvio" float [not null, default: 0]
  "retiroEnTienda" BOOL [not null, default: true]
  "fechaPublicacion" datetime [default: "now()"]
}


Table "calificacion" {
  "idCalificacion" INT [pk, not null, increment]
  "idUsuarioComprador" INT [not null]
  "idProducto" INT [not null]
  "idUsuarioVendedor" INT
  "idTienda" INT
  "foto" VARCHAR 
  "comentario" TEXT
  "nota" INT 
  "fecha" DATETIME [default: "now()"]

  Indexes {
    idUsuarioComprador [name: "idUsuarioComprador"]
    idUsuarioVendedor [name: "fk_calificacion_usuario1_idx"]
  }
}

Table "transaccion" {
  "idTransaccion" INT [pk, not null, increment]
  "idCarrito" INT [not null]
  "idComprador" INT [not null]
  "fecha" DATETIME 
  "monto" FLOAT 
  "metodoPago" VARCHAR(45) 
  "estado" transaccion_estado_enum

  Indexes {
    idCarrito [name: "idCarrito"]
    idComprador [name: "fk_transaccion_usuario1_idx"]
  }
}

Table "mensaje" {
  "idMensaje" INT [pk, not null, increment]
  "idUsuarioEmisor" INT [not null]
  "idUsuarioReceptor" INT [not null]
  "idTransaccionProducto" INT [not null]
  "contenido" TEXT 
  "fecha" DATETIME 

  Indexes {
    idUsuarioEmisor [name: "idUsuarioEmisor"]
    idUsuarioReceptor [name: "fk_mensaje_usuario1_idx"]
  }
}

Table "transaccionProducto" {
  "idTransaccionProducto" INT [pk, not null, increment]
  "idTransaccion" INT [not null]
  "idProducto" INT [not null]
  "cantidad" INT [not null]
  "fecha" DATETIME [default: "now()"]
  "direccion" TEXT
  "estadoEnvio" VARCHAR(45) 
  Indexes {
    idTransaccion [name: "fk_transaccionProducto_transaccion_idx"]
    idProducto [name: "fk_transaccionProducto_producto_idx"]
  }
}

Ref "idMarca": "modelo"."idMarca" - "marca"."idMarca"

Ref "bicicleta_ibfk_1": "modelo"."idModelo" - "bicicleta"."idBicicleta"

Ref "repuesto_ibfk_1":"modelo"."idModelo" < "componente"."idComponente"

Ref "modelo_ibfk_1":"bicicleta"."idCadena" - "componente"."idComponente"

Ref "modelo_ibfk_2":"bicicleta"."idRueda" -  "componente"."idComponente"

Ref "modelo_ibfk_3":"bicicleta"."idPedalier" -  "componente"."idComponente"

Ref "modelo_ibfk_4":"bicicleta"."idSillin" -  "componente"."idComponente"

Ref "modelo_ibfk_5":"bicicleta"."idFreno" -  "componente"."idComponente"

Ref "modelo_ibfk_6":"bicicleta"."idManubrio" -  "componente"."idComponente"

Ref "modelo_ibfk_7":"bicicleta"."idCassette" -  "componente"."idComponente"

Ref "marca_ibfk_1":"marca"."idMarca" <  "componente"."idComponente"

Ref "tienda_ibfk_1":"usuario"."idUsuario" < "tienda"."idUsuarioAdministrador" [update: cascade]

Ref "carrito_ibfk_1":"usuario"."idUsuario" < "carrito"."idUsuario" [update: cascade, delete: cascade]

Ref "carritoProducto_ibfk_1":"carrito"."idCarrito" < "carritoProducto"."idCarrito" [update: cascade, delete: cascade]

Ref: "producto"."idProducto" < "carritoProducto"."idProducto" [update: no action, delete: no action]

Ref "documento_ibfk_1":"modelo"."idModelo" < "documento"."idModelo" [update: cascade, delete: cascade]

Ref "documento_ibfk_2":"usuario"."idUsuario" < "documento"."idUsuario" [update: cascade, delete: cascade]

Ref "calificacion_ibfk_1":"usuario"."idUsuario" < "calificacion"."idUsuarioComprador" [delete: cascade]

Ref "fk_calificacion_usuario1":"usuario"."idUsuario" < "calificacion"."idUsuarioVendedor" [update: no action, delete: no action]

Ref: "producto"."idProducto" < "calificacion"."idProducto" [update: no action, delete: no action]

Ref "transaccion_ibfk_1":"carrito"."idCarrito" < "transaccion"."idCarrito" [delete: cascade]

Ref "fk_transaccion_usuario1":"usuario"."idUsuario" < "transaccion"."idComprador" [update: no action, delete: no action]

Ref "mensaje_ibfk_1":"usuario"."idUsuario" < "mensaje"."idUsuarioEmisor" [update: cascade, delete: cascade]

Ref:"transaccionProducto"."idTransaccionProducto" < "mensaje"."idTransaccionProducto" [update: no action, delete: no action]

Ref "fk_mensaje_usuario1":"usuario"."idUsuario" < "mensaje"."idUsuarioReceptor" [update: no action, delete: no action]

Ref "imagen_modelo": "imagen"."idModelo" > "modelo"."idModelo" 

Ref "imagen_documento": "imagen"."idDocumento" > "documento"."idDocumento"

Ref "imagen_usuario": "imagen"."idUsuario" - "usuario"."idUsuario"

Ref: "modelo"."idModelo" < "producto"."idModelo"

Ref: "tienda"."idTienda" < "producto"."idTienda"

Ref: "usuario"."idUsuario" < "producto"."idVendedor"

Ref: "tienda"."idTienda" < "calificacion"."idTienda"

Ref: "transaccion"."idTransaccion" < "transaccionProducto"."idTransaccion"

Ref: "transaccionProducto"."idProducto" > "producto"."idProducto"